# Решение проблем со сборкой

## Проблема: "Cannot find module './XXXX.js'"

Эта ошибка возникает когда webpack не может найти скомпилированный chunk файл. Обычно происходит в dev режиме после изменений в структуре модулей.

### Причины

1. **Устаревший кэш webpack** - после изменений в импортах/экспортах старые ссылки остаются в `.next`
2. **Hot-reload конфликты** - Next.js пытается загрузить чанк который был пересобран
3. **Изменения в структуре модулей** - перемещение файлов создает несоответствия

### Решение

#### Автоматическое (рекомендуется)

```bash
npm run build
```

Скрипт `prebuild` автоматически:
1. Очищает `.next` директорию
2. Проверяет структуру проекта
3. Выполняет чистую сборку

#### Ручное

```bash
# Остановить dev сервер
# Ctrl+C или:
pkill -f "next dev"

# Очистить кэш
rm -rf .next

# Перезапустить
npm run dev
```

### Профилактика

1. **Всегда используйте `npm run build` перед деплоем** - скрипт автоматически очищает кэш
2. **Не коммитьте `.next`** - директория в `.gitignore`
3. **В production всегда чистая сборка** - FastPanel/GitHub Actions выполняют `npm ci && npm run build`

## Настройки проекта

### next.config.mjs

Конфигурация включает:
- Оптимизацию импортов пакетов
- Правильное кэширование webpack в dev режиме
- Автоматическую очистку при изменениях

### Скрипты

- `npm run clean` - очистка `.next` и кэша
- `npm run prebuild` - автоматическая очистка и проверка перед сборкой
- `npm run build` - production сборка с автоматической очисткой

## Проверка перед деплоем

Скрипт `pre-build-check.ts` проверяет:
- ✅ Отсутствие циклических зависимостей
- ✅ Наличие критичных файлов
- ✅ Корректность структуры импортов

## Production

В production эта проблема **не возникает**, так как:
1. Всегда выполняется чистая сборка (`npm ci && npm run build`)
2. Нет hot-reload
3. Webpack генерирует стабильные chunks

Если проблема возникает в production:
1. Проверьте что выполняется `npm run build` (не `npm run dev`)
2. Убедитесь что `.next` не коммитится в git
3. Проверьте что на сервере чистая установка зависимостей (`npm ci`)


