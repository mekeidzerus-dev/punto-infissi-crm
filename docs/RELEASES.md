# История релизов

## Релиз 1.3.0 - 2025-11-03
**Автор:** MekeidzeRH

**Новые возможности:**
- Настройки компании теперь хранятся в БД (phone, email, address)
- Умный парсер данных клиента с автоматическим распознаванием:
  - Телефон (с валидацией итальянских номеров +39)
  - Email (с валидацией формата)
  - Имя/Фамилия (с автоисправлением регистра)
  - Компания (для 3+ слов)
- Система статусов документов с привязкой к типам:
  - Типы: Предложения, Заказы, Счета
  - Статусы: Черновик, Отправлено, Утверждено, Отклонено, В производстве, Завершено, Отменено
  - Управление через UI в настройках
  - Цветные бейджи для статусов
- Оптимизированный UI блока итогов в предложениях (компактнее)

**Исправления:**
- Убран hardcode из настроек компании
- Улучшена валидация при создании клиента из предложения
- Статусы предложений теперь загружаются из БД

**Технические изменения:**
- Добавлены поля `phone`, `email`, `address` в модель `Organization`
- Созданы модели `DocumentType`, `DocumentStatus`, `DocumentStatusType`
- Создан `client-input-parser.ts` для умного парсинга
- API: `/api/document-statuses`, `/api/document-types`
- Компонент `document-statuses-manager.tsx` для управления статусами
- Seed-скрипт `seed-document-statuses.ts` для начальных данных

**Файлы:**
- `prisma/schema.prisma` - новые модели и поля
- `prisma/seed-document-statuses.ts` - seed статусов
- `src/app/api/organization/route.ts` - сохранение контактов
- `src/app/api/document-statuses/route.ts` - CRUD статусов
- `src/app/api/document-types/route.ts` - получение типов
- `src/components/general-settings.tsx` - загрузка из БД
- `src/lib/client-input-parser.ts` - парсер клиентов
- `src/components/proposal-form-v3.tsx` - интеграция парсера и статусов
- `src/components/document-statuses-manager.tsx` - UI управления
- `src/components/dictionaries-section.tsx` - добавлена вкладка статусов

**Тестирование:**
- ✅ Сохранение настроек компании в БД
- ✅ Парсинг различных форматов ввода клиента
- ✅ Валидация и автоисправление телефонов
- ✅ Создание и управление статусами документов
- ✅ Отображение статусов в предложениях

---

## Релиз 1.2.0 - 2025-11-02
**Автор:** MekeidzeRH

**Новые возможности:**
- Системные параметры размеров (Ширина, Высота) с автоматическим отображением во всех категориях
- Автоматический расчет площади (м²) в названии товара
- Улучшенное формирование названий товаров:
  - Булевые параметры: "Название: Да/No" с локализацией
  - Размеры: формат "800x2100 мм | 1.68 м²"
  - Остальные параметры: только значение без названия
- Системные налоговые ставки НДС (4%, 5%, 10%, 22%) с защитой от удаления
- Отдельный блок "Размеры" в конфигураторе с визуальным выделением
- Кнопка "Conferma" перенесена в левую панель конфигуратора
- Фиксированные ширины колонок в таблице продуктов (без сжатия при длинном тексте)
- Переносы текста в названиях товаров

**Исправления:**
- Удалена наклейка AUTO из списка товаров
- Исправлена сортировка параметров (Ширина → Высота)
- Исправлена конвертация булевых значений в строки
- Защита системных данных от удаления в UI

**Технические изменения:**
- Добавлено поле `isSystem` в модели `ParameterTemplate` и `VATRate`
- Созданы seed-скрипты: `seed-system-parameters.ts`, `seed-vat-standard.ts`
- Обновлен `product-name-generator.ts` для расчета площади
- Обновлен API `/api/category-parameters` для возврата `isSystem`
- Обновлена сортировка параметров (специальная логика для размеров)

**Файлы:**
- `prisma/schema.prisma` - добавлены поля isSystem
- `prisma/seed-system-parameters.ts` - новый
- `prisma/seed-vat-standard.ts` - новый
- `src/app/api/category-parameters/route.ts` - обновлена сортировка
- `src/components/parameters-configuration.tsx` - блок размеров
- `src/components/proposal-form-v3.tsx` - фиксированные колонки, удалена наклейка
- `src/lib/product-name-generator.ts` - расчет площади, булевые параметры
- `src/components/parameters-manager.tsx` - защита от удаления
- `src/components/vat-rates-manager.tsx` - защита от удаления

**Тестирование:**
- ✅ Системные параметры отображаются во всех категориях
- ✅ Булевые параметры формируются корректно с локализацией
- ✅ Расчет площади работает (мм → м²)
- ✅ Системные данные защищены от удаления
- ✅ UI корректно отображается с фиксированными колонками

---

## Релиз 1.1.0 - 2025-10-15
**Автор:** MekeidzeRH

**Новые возможности:**
- Система предложений (Proposals)
- Конфигуратор продуктов V2
- Генерация PDF документов
- Управление налоговыми ставками

---

