# 📊 Руководство по отображению НДС в документах

**Дата:** 16 октября 2025  
**Версия:** 2.0

---

## 🎯 Концепция

НДС всегда отображается **отдельной строкой** после подитога и скидки, чтобы клиент ясно видел:

1. Цену без НДС
2. Сумму НДС отдельно
3. Итоговую цену с НДС

**Или** если НДС = 0%:

1. Цену без НДС
2. Уведомление "НДС не включён"
3. Предупреждение, что НДС будет рассчитан позже

---

## 📐 Визуальная структура итогов

### Вариант 1: С НДС (НДС > 0%)

```
┌─────────────────────────────────────────┐
│ Итоги предложения                       │
├─────────────────────────────────────────┤
│ Промежуточный итог:        2950.00 €   │
│ Скидка:                     -232.50 €   │
├─────────────────────────────────────────┤
│ Итог без НДС:              2717.50 €   │
│ НДС:                        +455.35 €   │ ← СИНИЙ ЦВЕТ
├═════════════════════════════════════════┤
│ 🟢 ИТОГО с НДС:            3172.85 €   │ ← ЗЕЛЁНЫЙ ФОН
└─────────────────────────────────────────┘
```

### Вариант 2: Без НДС (НДС = 0%)

```
┌─────────────────────────────────────────┐
│ Итоги предложения                       │
├─────────────────────────────────────────┤
│ Промежуточный итог:        2950.00 €   │
│ Скидка:                     -232.50 €   │
├─────────────────────────────────────────┤
│ Итог без НДС:              2717.50 €   │
│ НДС:                    Не включён     │ ← ЯНТАРНЫЙ ЦВЕТ
├═════════════════════════════════════════┤
│ 🟢 ИТОГО (без НДС):        2717.50 €   │ ← ЗЕЛЁНЫЙ ФОН
├─────────────────────────────────────────┤
│ ⚠️ ВАЖНО: НДС будет рассчитан позже    │ ← ЯНТАРНОЕ ПРЕДУПРЕЖДЕНИЕ
│   в зависимости от условий клиента      │
└─────────────────────────────────────────┘
```

---

## 🎨 Цветовая кодировка

| Элемент            | Цвет                        | Значение                   |
| ------------------ | --------------------------- | -------------------------- |
| Промежуточный итог | Серый (`text-gray-600`)     | Базовая информация         |
| Скидка             | Красный (`text-red-600`)    | Уменьшение суммы           |
| Итог без НДС       | Чёрный (`font-semibold`)    | Важная промежуточная сумма |
| НДС (с суммой)     | Синий (`text-blue-600`)     | Добавление к сумме         |
| НДС (не включён)   | Янтарный (`text-amber-600`) | Предупреждение             |
| ИТОГО с НДС        | Зелёный (`text-green-600`)  | Финальная сумма            |
| ИТОГО без НДС      | Зелёный (`text-green-600`)  | Финальная сумма            |

---

## 💡 Бизнес-логика

### Когда использовать НДС 0%?

1. **Неизвестные условия клиента:**

   - Клиент ещё не предоставил документы
   - Неясно, имеет ли право на льготную ставку

2. **Предварительная оценка:**

   - Клиент хочет видеть цену "от"
   - Итоговая ставка будет определена позже

3. **Специальные случаи:**
   - Экспорт (может быть без НДС)
   - Льготные категории граждан

### Рабочий процесс:

```
Шаг 1: Создаём предложение с НДС 0%
        ↓
Клиент: "Мне подходит, могу получить льготу"
        ↓
Шаг 2: Редактируем предложение → меняем НДС на 4%
        ↓
Итог: Автоматический пересчёт всех сумм
```

---

## 📋 Доступные ставки НДС

| Ставка | Название         | Когда применяется                 |
| ------ | ---------------- | --------------------------------- |
| 0%     | IVA 0% / Без НДС | Расчёт позже, экспорт             |
| 4%     | IVA 4%           | Социально значимые товары         |
| 10%    | IVA 10%          | Строительные работы (условно)     |
| 22%    | IVA 22% ⭐       | Стандартная ставка (по умолчанию) |

---

## 🔧 Технические детали

### Расчёт позиции с НДС:

```typescript
// 1. Подитог
subtotal = unitPrice × quantity

// 2. Скидка
discountAmount = subtotal × (discount / 100)

// 3. Без НДС
beforeVat = subtotal - discountAmount

// 4. НДС
vatAmount = beforeVat × (vatRate / 100)

// 5. С НДС
total = beforeVat + vatAmount
```

### Пример расчёта:

**Дверь ПВХ:**

- Цена: 850€ × 2 шт = **1700€** (subtotal)
- Скидка 10%: -170€
- **Без НДС: 1530€** ← показываем клиенту
- НДС 22%: +336.60€
- **С НДС: 1866.60€** ← финальная цена

**Если НДС = 0%:**

- Цена: 850€ × 2 шт = **1700€**
- Скидка 10%: -170€
- **Без НДС: 1530€** ← ИТОГО
- НДС: **"Не включён"** ⚠️
- Примечание: "НДС будет рассчитан позже"

---

## 📄 Отображение в PDF

### В печатной форме:

```
╔═══════════════════════════════════════════╗
║ PREVENTIVO / ПРЕДЛОЖЕНИЕ                  ║
║ № PROP-001                                ║
╠═══════════════════════════════════════════╣
║ Cliente: Mario Rossi                      ║
║ Data: 16.10.2025                          ║
╠═══════════════════════════════════════════╣
║ PRODOTTI                                  ║
║ ───────────────────────────────────────── ║
║ 1. Porta PVC 900x2100                     ║
║    Q.tà: 2 × 850.00€ = 1700.00€          ║
║    Sconto 10%: -170.00€                   ║
║    Senza IVA: 1530.00€                    ║
║    IVA 22%: +336.60€                      ║
║    Totale: 1866.60€                       ║
╠═══════════════════════════════════════════╣
║ TOTALI                                    ║
║ Subtotale:              2950.00€         ║
║ Sconto:                 -232.50€         ║
║ ─────────────────────────────────────     ║
║ Totale senza IVA:       2717.50€         ║
║ IVA:                    +455.35€         ║
║ ═════════════════════════════════════     ║
║ TOTALE con IVA:         3172.85€         ║
╚═══════════════════════════════════════════╝

* Se l'IVA non è inclusa, sarà calcolata
  successivamente in base alle condizioni
  del cliente.
```

---

## 🌍 Мультиязычность

### Русский (RU):

- `totalWithoutVat`: "ИТОГО (без НДС)"
- `vatNotIncluded`: "Не включён"
- `vatWillBeCalculatedLater`: "НДС будет рассчитан позже в зависимости от условий клиента"
- `important`: "Важно"

### Итальянский (IT):

- `totalWithoutVat`: "TOTALE (senza IVA)"
- `vatNotIncluded`: "Non inclusa"
- `vatWillBeCalculatedLater`: "L'IVA sarà calcolata successivamente in base alle condizioni del cliente"
- `important`: "Importante"

---

## ✅ Checklist для менеджеров

При создании предложения:

- [ ] Определён ли статус клиента по НДС?

  - ✅ Да → выбрать правильную ставку (4%, 10%, 22%)
  - ❌ Нет → выбрать **НДС 0%**

- [ ] Клиент видит предупреждение о НДС?

  - ✅ Янтарное поле с ⚠️ отображается

- [ ] Итоговая сумма понятна?

  - ✅ "ИТОГО (без НДС)" вместо "ИТОГО с НДС"

- [ ] После уточнения условий:
  - ✅ Отредактировать предложение
  - ✅ Выбрать правильную ставку НДС
  - ✅ Система автоматически пересчитает все суммы

---

## 🚀 Готово к использованию!

Система автоматически:

- ✅ Показывает "+€X.XX" синим, если НДС > 0
- ✅ Показывает "Не включён" янтарным, если НДС = 0
- ✅ Меняет заголовок итога: "с НДС" / "без НДС"
- ✅ Выводит предупреждение для клиента

**Проверьте:** Создайте предложение с НДС 0% и с НДС 22% - увидите разницу! 🎯
