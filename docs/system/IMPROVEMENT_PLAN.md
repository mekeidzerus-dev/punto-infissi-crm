# План улучшения системы предложений параметров

## 🎯 Текущая проблема

1. **Слишком много окон** - пользователь должен открывать отдельное модальное окно для предложения
2. **Неудобный процесс** - не интуитивно понятно, как добавить новое значение
3. **Нет прямого добавления** - нужно ждать одобрения администратора

## ✅ Новое решение

### 1. **Прямое добавление в форме**

- Кнопка "+ Добавить значение" прямо в SELECT/COLOR полях
- Кнопка "+ Добавить параметр" в конце списка параметров
- Мгновенное создание без модальных окон

### 2. **Статусы значений/параметров**

```typescript
enum ApprovalStatus {
	APPROVED = 'approved', // Одобрено администратором
	PENDING = 'pending', // Ожидает согласования
	REJECTED = 'rejected', // Отклонено
}
```

### 3. **Визуальные индикаторы**

- ✅ Зелёная галочка - одобрено
- ⏳ Жёлтый значок - на согласовании
- ❌ Красный крестик - отклонено

### 4. **Автоматическое одобрение для админа**

- Если пользователь = администратор → статус сразу `APPROVED`
- Если обычный пользователь → статус `PENDING`

### 5. **Панель администратора**

- Settings → "Параметры на согласовании"
- Список всех PENDING параметров/значений
- Кнопки: Одобрить / Отклонить
- Причина отклонения (опционально)

## 📝 Изменения в базе данных

### ParameterTemplate

```prisma
model ParameterTemplate {
  // ... существующие поля
  approvalStatus  ApprovalStatus @default(PENDING)
  createdBy       String?        // userId или 'admin'
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?
}
```

### ParameterValue

```prisma
model ParameterValue {
  // ... существующие поля
  approvalStatus  ApprovalStatus @default(PENDING)
  createdBy       String?
  approvedBy      String?
  approvedAt      DateTime?
  rejectedBy      String?
  rejectedAt      DateTime?
  rejectionReason String?
}
```

## 🎨 UI изменения

### В конфигураторе продукта

#### SELECT поле:

```
┌─────────────────────────────────────────────┐
│ Материал *                                  │
├─────────────────────────────────────────────┤
│ ○ МДФ ✅                                    │
│ ○ Массив дерева ✅                          │
│ ○ Шпон ✅                                   │
│ ○ Пластик ⏳ (на согласовании)             │
│                                             │
│ [+ Добавить новое значение]                 │
└─────────────────────────────────────────────┘
```

#### Добавление значения:

```
При клике на "+ Добавить":
┌─────────────────────────────────────────────┐
│ Новое значение:                             │
│ ┌─────────────────────────────────────────┐ │
│ │ [введите значение...]                   │ │
│ └─────────────────────────────────────────┘ │
│ [Добавить] [Отмена]                         │
└─────────────────────────────────────────────┘

После добавления:
→ Значение появляется в списке с меткой ⏳
→ Автоматически выбирается
→ Пользователь может продолжать работу
```

### В настройках администратора

```
Settings → Параметры на согласовании

┌─────────────────────────────────────────────────────────────┐
│ ПАРАМЕТРЫ НА СОГЛАСОВАНИИ (3)                              │
├─────────────────────────────────────────────────────────────┤
│ ⏳ Толщина полотна (NUMBER)                                │
│    Создано: user123 | 19.10.2025 18:30                     │
│    [✅ Одобрить] [❌ Отклонить]                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ЗНАЧЕНИЯ НА СОГЛАСОВАНИИ (5)                               │
├─────────────────────────────────────────────────────────────┤
│ ⏳ Материал → Пластик                                      │
│    Создано: user456 | 19.10.2025 17:15                     │
│    [✅ Одобрить] [❌ Отклонить]                            │
├─────────────────────────────────────────────────────────────┤
│ ⏳ Цвет → Золотой                                          │
│    Создано: user789 | 19.10.2025 16:45                     │
│    [✅ Одобрить] [❌ Отклонить]                            │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 Преимущества нового подхода

1. ✅ **Меньше кликов** - добавление за 2 клика вместо 5+
2. ✅ **Нет модальных окон** - всё inline
3. ✅ **Мгновенная работа** - пользователь не ждёт одобрения
4. ✅ **Прозрачность** - видно какие значения на согласовании
5. ✅ **Контроль администратора** - всё в одном месте

## 📋 Этапы реализации

### Этап 1: База данных

- [ ] Добавить `approvalStatus` в `ParameterTemplate`
- [ ] Добавить `approvalStatus` в `ParameterValue`
- [ ] Добавить поля для отслеживания (createdBy, approvedBy и т.д.)
- [ ] Создать enum `ApprovalStatus`

### Этап 2: API

- [ ] Обновить `/api/parameters` - фильтр по статусу
- [ ] Обновить `/api/parameter-values` - фильтр по статусу
- [ ] Создать `/api/admin/pending-parameters` - список на согласовании
- [ ] Создать `/api/admin/approve-parameter` - одобрение
- [ ] Создать `/api/admin/reject-parameter` - отклонение

### Этап 3: UI Конфигуратора

- [ ] Добавить кнопку "+ Добавить" в SELECT
- [ ] Добавить кнопку "+ Добавить" в COLOR
- [ ] Inline форма добавления значения
- [ ] Визуальные индикаторы статуса
- [ ] Автоопределение роли пользователя

### Этап 4: UI Администратора

- [ ] Страница "Параметры на согласовании"
- [ ] Список pending параметров
- [ ] Список pending значений
- [ ] Кнопки одобрения/отклонения
- [ ] Форма причины отклонения

### Этап 5: Тестирование

- [ ] Тест создания параметра обычным пользователем
- [ ] Тест создания параметра администратором
- [ ] Тест одобрения
- [ ] Тест отклонения
- [ ] Тест использования pending значений

## ⚡ Приоритет

**ВЫСОКИЙ** - это критично для UX и продуктивности пользователей
