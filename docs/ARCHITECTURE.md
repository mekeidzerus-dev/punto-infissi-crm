# Архитектура приложения

**Тип:** Монолитное Next.js приложение

## Структура

```
Frontend (React) → API Routes → Prisma → PostgreSQL
```

## Технологии

- **Next.js 15** - App Router
- **React 19** - UI
- **Prisma** - ORM
- **PostgreSQL** - БД
- **TypeScript** - типизация

## Модули

- Аутентификация (NextAuth)
- Клиенты (CRUD)
- Поставщики/Партнёры/Монтажники
- Категории и параметры продуктов
- Конфигуратор продуктов (V2)
  - Системные параметры размеров (Ширина×Высота)
  - Автоматический расчет площади (м²)
  - Формирование названий с локализацией
- Предложения (Proposals)
- PDF генерация

---

## Анализ улучшений

### 1. Unit-тесты (Vitest)

**Приоритет:** ⚠️ Средний (3/5)

**Что получаешь:**

- ✅ Защита от регрессий в бизнес-логике
- ✅ Быстрая проверка функций (мс вместо секунд)
- ✅ Уверенность при рефакторинге

**Стоит ли сейчас:**

- ❌ НЕТ — приложение стабильное, нет активной разработки сложной логики
- ✅ ДА — если планируешь менять расчёт цен, валидацию, HEX→RAL

**Рекомендация:** Добавить позже, когда появится сложная логика или команда

---

### 2. E2E-тесты (Playwright)

**Приоритет:** ✅ Высокий (4/5)

**Что получаешь:**

- ✅ Защита критичных путей (создание предложения, конфигуратор)
- ✅ Автоматическая проверка после деплоя
- ✅ Документация через тесты

**Стоит ли сейчас:**

- ✅ ДА — если планируешь деплой в продакшен
- ✅ ДА — защита от поломок критичных фич

**Рекомендация:** Добавить 3-5 тестов для критичных сценариев:

- Создание предложения
- Конфигуратор продукта
- CRUD клиентов

---

### 3. Типы и константы в отдельные папки

**Приоритет:** ✅ Высокий (4/5)

**Что получаешь:**

- ✅ Переиспользование типов
- ✅ Меньше дублирования
- ✅ Легче поддерживать

**Стоит ли сейчас:**

- ✅ ДА — быстрая правка, низкий риск
- ✅ Улучшит качество кода

**Рекомендация:** Сделать сейчас — 30 минут работы, сразу станет чище

**План:**

```
src/types/
  - client.ts
  - proposal.ts
  - parameter.ts
src/constants/
  - routes.ts
  - statuses.ts
```

---

### 4. Дизайн-токены (styles/tokens.ts)

**Приоритет:** ⚠️ Средний (2/5)

**Что получаешь:**

- ✅ Единые цвета/отступы в одном месте
- ✅ Легче менять тему

**Стоит ли сейчас:**

- ❌ НЕТ — уже используется Tailwind CSS (токены в globals.css)
- ✅ ДА — если планируешь менять цвета часто

**Рекомендация:** Пропустить — Tailwind уже решает эту задачу

---

### 5. Storybook

**Приоритет:** ❌ Низкий (1/5)

**Что получаешь:**

- ✅ Документация компонентов
- ✅ Изоляция для разработки

**Стоит ли сейчас:**

- ❌ НЕТ — проект небольшой, компонентов 15-20
- ❌ НЕТ — лишняя инфраструктура
- ✅ ДА — если планируется команда или много компонентов

**Рекомендация:** Пропустить — избыточно для текущего размера проекта

---

## Итоговая рекомендация

**Сделать сейчас (высокий приоритет):**

1. ✅ Вынести типы и константы (30 мин)

**Сделать после (средний приоритет):** 2. ✅ E2E-тесты для критичных сценариев (2-3 часа) 3. ⚠️ Unit-тесты для бизнес-логики (когда появится сложная логика)

**Не делать:** 4. ❌ Дизайн-токены (Tailwind решает) 5. ❌ Storybook (избыточно)
